CREATE TABLE TIER
(
  TierID SERIAL NOT NULL,
  TierName VARCHAR(100) NOT NULL,
  TierLevel INT NOT NULL,
  PRIMARY KEY (TierID)
);

CREATE TABLE SALES_TRANSACTION
(
  TimeOfTransaction DATE NOT NULL,
  CryptoUsed VARCHAR(100) NOT NULL,
  Amount NUMERIC NOT NULL,
  TransactionID SERIAL NOT NULL,
  Username VARCHAR(100) NOT NULL,
  TierID INT NOT NULL,
  PRIMARY KEY (TransactionID),
  FOREIGN KEY (Username) REFERENCES USER(Username),
  FOREIGN KEY (TierID) REFERENCES TIER(TierID)
);

CREATE TABLE USER
(
  Password VARCHAR(100) NOT NULL,
  Email VARCHAR(100),
  Username VARCHAR(100) NOT NULL,
  TierID INT NOT NULL,
  Refers_Username VARCHAR(100),
  PRIMARY KEY (Username),
  FOREIGN KEY (TierID) REFERENCES TIER(TierID),
  FOREIGN KEY (Refers_Username) REFERENCES USER(Username)
);

CREATE TABLE MACHINE
(
  MachineID SERIAL NOT NULL,
  IPAddress VARCHAR(100) NOT NULL,
  LastCheckIn DATE NOT NULL,
  OperatingSystem VARCHAR(100) NOT NULL,
  Version VARCHAR(100) NOT NULL,
  Cores INT NOT NULL,
  Ram INT NOT NULL,
  TierID INT NOT NULL,
  Username VARCHAR(100) NOT NULL,
  PRIMARY KEY (MachineID),
  FOREIGN KEY (TierID) REFERENCES TIER(TierID),
  FOREIGN KEY (Username) REFERENCES USER(Username)
);

CREATE TABLE Tasks
(
  TaskID SERIAL NOT NULL,
  TaskType VARCHAR(100) NOT NULL,
  Username VARCHAR(100) NOT NULL,
  PRIMARY KEY (TaskID),
  FOREIGN KEY (Username) REFERENCES USER(Username)
);

CREATE TABLE Executes
(
  TaskID INT NOT NULL,
  MachineID INT NOT NULL,
  PRIMARY KEY (TaskID, MachineID),
  FOREIGN KEY (TaskID) REFERENCES Tasks(TaskID),
  FOREIGN KEY (MachineID) REFERENCES MACHINE(MachineID)
);
